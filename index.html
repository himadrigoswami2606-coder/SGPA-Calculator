<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Narula University Grade Portal</title>
<link rel="icon" href="data:," />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1: #05060a;
    --bg2: #071227;
    --card: rgba(255,255,255,0.04);
    --glass: rgba(255,255,255,0.03);
    --muted: rgba(255,255,255,0.6);
    --accent: #00eaff;
    --accent-2: #7ae1ff;
    --success: #7ef3c5;
    --danger: #ff6b6b;
    --card-radius: 16px;
    --max-width: 1100px;
  }
  /* light overrides */
  body.light {
    --bg1: #f3f7fb;
    --bg2: #e9f0fb;
    --card: rgba(0,0,0,0.04);
    --glass: rgba(10,12,20,0.03);
    --muted: rgba(10,20,30,0.8);
    --accent: #0077ff;
    --accent-2: #00bfa6;
    color: #081225;
  }

  *{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
  html,body{height:100%;margin:0;background:radial-gradient(circle at 10% 10%, #07142a 0%, #000 40%);color:#eaf6ff; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;}
  body{transition:background 350ms ease,color 350ms ease; touch-action:auto; -webkit-text-size-adjust:100%}

  .sky {
    position: fixed; inset: 0; z-index: 0; pointer-events:none;
    background:
      radial-gradient(ellipse at top left, rgba(255,255,255,0.02) 0%, transparent 10%),
      radial-gradient(ellipse at bottom right, rgba(255,255,255,0.01) 0%, transparent 12%);
    mix-blend-mode: overlay;
  }

  .wrap{min-height:100vh;display:flex;align-items:flex-start;justify-content:center;padding:48px 20px;z-index:1;position:relative; -webkit-overflow-scrolling: touch;}
  .card{
    width:100%;max-width:var(--max-width);padding:22px;border-radius:var(--card-radius);
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    backdrop-filter: blur(8px) saturate(120%);
    box-shadow: 0 12px 40px rgba(2,6,23,0.6);
    border: 1px solid rgba(255,255,255,0.03);
    position: relative;
    overflow: hidden; /* keep desktop unchanged */
  }

  header.top{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:16px}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:700;color:#001821;font-size:18px;box-shadow:0 6px 18px rgba(0,0,0,0.35)}
  h1{margin:0;font-size:20px;color:var(--accent);letter-spacing:0.4px}
  .subtitle{font-size:13px;color:var(--muted);margin-top:3px}

  .controlsTop{display:flex;gap:10px;align-items:center}
  .themeToggle{display:inline-flex;align-items:center;gap:10px;padding:8px 10px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.04);cursor:pointer;color:var(--muted)}
  .themeToggle .icon{font-size:18px}

  .profile{display:flex;gap:8px;align-items:center;background:var(--glass);padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}
  .profile input{background:transparent;border:none;color:inherit;padding:6px 8px;border-radius:8px;min-width:120px;outline:none}
  .profile .small{font-size:12px;color:var(--muted)}

  .grid{display:grid;grid-template-columns:1fr 360px;gap:18px}
  @media (max-width:980px){ .grid{grid-template-columns:1fr} }

  .panel{padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.006));border:1px solid rgba(255,255,255,0.03)}
  .sectionTitle{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
  .sectionTitle h2{margin:0;font-size:16px;color:var(--accent)}
  .muted{font-size:13px;color:var(--muted)}

  .tabs{display:flex;gap:8px;margin-bottom:12px}
  .tab{padding:8px 12px;border-radius:10px;cursor:pointer;background:transparent;border:1px solid rgba(255,255,255,0.02);color:var(--muted)}
  .tab.active{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#001821;font-weight:700;box-shadow:0 6px 18px rgba(0,0,0,0.25)}

  .semList{display:flex;flex-direction:column;gap:12px}
  .semester{border-radius:10px;padding:12px;background:rgba(255,255,255,0.01);border:1px solid rgba(255,255,255,0.03)}
  .semHead{display:flex;align-items:center;justify-content:space-between;gap:8px}
  .semTitle{font-weight:700}
  .semControls{display:flex;gap:8px}

  .subjects{margin-top:10px;display:flex;flex-direction:column;gap:10px}
  /* Now subjectRow includes type selector as first column */
  .subjectRow{display:grid;grid-template-columns:110px 1fr 80px 90px 90px 64px;gap:8px;align-items:center}
  @media (max-width:980px){ .subjectRow{grid-template-columns: 1fr 80px 80px 60px } }

  .subjectRow select,.subjectRow input[type="text"]{padding:8px;border-radius:8px;border:none;background:rgba(0,0,0,0.25);color:inherit}
  .subjectRow input[type="number"]{padding:8px;border-radius:8px;border:none;background:rgba(0,0,0,0.18);color:inherit}
  .subjectRow .removeRow{padding:6px;border-radius:8px;border:none;background:transparent;color:var(--muted);cursor:pointer}

  .rightPanel{padding:14px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.003));border:1px solid rgba(255,255,255,0.03)}
  .cardStat{display:flex;flex-direction:column;gap:8px;margin-bottom:12px}
  .big{font-size:24px;font-weight:700;color:var(--success)}
  .actionBtn{width:100%;padding:10px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#001821;font-weight:700;cursor:pointer}
  .outline{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);padding:8px;border-radius:8px;cursor:pointer}

  table{width:100%;border-collapse:collapse;margin-top:8px}
  th,td{padding:8px;text-align:left;border-bottom:1px dashed rgba(255,255,255,0.03);font-size:13px;color:var(--muted)}
  th{color:var(--accent);font-size:13px}

  footer.note{margin-top:12px;font-size:12px;color:var(--muted)}

  .row{display:flex;gap:8px;align-items:center}
  .select{padding:8px;border-radius:8px;border:none;background:rgba(0,0,0,0.15);color:inherit}
  .presetDropdown{min-width:220px}

  /* login overlay improved contrast */
  .overlay {
    position: fixed; inset: 0; background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)); display:flex;align-items:center;justify-content:center;z-index:9999;
  }
  .loginCard {
    width: 540px; max-width:94%; padding:28px; border-radius:14px;
    background: linear-gradient(180deg, rgba(0,0,0,0.7), rgba(0,0,0,0.55));
    border:1px solid rgba(255,255,255,0.04); box-shadow:0 30px 80px rgba(0,0,0,0.7); text-align:center;
    color:#fff;
  }
  .loginCard h2{margin:0 0 8px;color:var(--accent)}
  .loginCard p{color:rgba(255,255,255,0.75);margin:0 0 18px}
  .loginCard input{width:100%;padding:12px;border-radius:10px;border:none;background:rgba(255,255,255,0.06);color:inherit;margin-bottom:10px;outline:none}
  .loginCard input::placeholder{color:rgba(255,255,255,0.6)}

  /* micro animations */
  .glow { box-shadow: 0 8px 30px rgba(0,234,255,0.06); transition: box-shadow 350ms ease; }
  .glow:hover { box-shadow: 0 12px 44px rgba(0,234,255,0.12); transform: translateY(-2px); }

  /* Result popup (glass) */
  .resultPopupOverlay {
    position: fixed; inset: 0; display:none; z-index:10050;
    background: linear-gradient(rgba(0,0,0,0.45), rgba(0,0,0,0.45));
    align-items:center; justify-content:center; padding:20px;
  }
  .resultPopup {
    width: 620px; max-width:95%; border-radius:14px; padding:18px;
    background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
    backdrop-filter: blur(10px) saturate(120%);
    border: 1px solid rgba(255,255,255,0.06);
    color: inherit; box-shadow: 0 20px 60px rgba(0,0,0,0.6);
  }
  .resultHeader{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:8px}
  .resultMain{display:flex;gap:16px;align-items:center}
  .resultValues{flex:1}
  .resultValues .big{font-size:36px}
  .closePopup{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:10px;cursor:pointer;color:var(--muted)}

  /* SGPA color bar (inside popup and persistent) */
  .sgpaBarWrap{margin-top:12px}
  .sgpaBar{
    height:18px;border-radius:10px;overflow:hidden;border:1px solid rgba(0,0,0,0.12);display:flex;
  }
  .sgpaSeg{flex:1;height:100%}
  .segRed{background:linear-gradient(90deg,#ff6b6b,#ff3b3b)}
  .segYellow{background:linear-gradient(90deg,#ffd166,#ffb84d)}
  .segLightGreen{background:linear-gradient(90deg,#9ff3c8,#55e8a6)}
  .segDarkGreen{background:linear-gradient(90deg,#2bd97b,#0fa65f)}
  .sgpaMarker{position:relative}
  .markerDot{position:absolute;top:-6px;width:12px;height:12px;border-radius:50%;background:#001821;border:3px solid #fff;box-shadow:0 6px 18px rgba(0,0,0,0.4);left:0%;transform:translateX(-50%);}

  /* small persistent display in rightPanel */
  .persistentBarWrap{margin-top:12px}
  .persistentBarLabel{font-size:13px;color:var(--muted);margin-bottom:6px}

  @media (max-width:560px){
    .profile input{min-width:80px}
    .subjectRow{grid-template-columns: 1fr 70px 70px 60px;}
  }

  /* ðŸ“± Mobile Responsive Fix (keeps PC layout unchanged) */
  @media (max-width: 768px) {
    body {
      padding: 10px;
      overflow-x: auto; /* ensures horizontal panning possible on small devices */
      -webkit-overflow-scrolling: touch;
    }

    .wrap { padding: 18px 8px; }

    /* allow card inner content to be scrolled on small screens if it overflows */
    .card { overflow: visible; }

    .card, .loginCard {
      width: 95%;
      margin: 10px auto;
      border-radius: 16px;
      backdrop-filter: blur(10px);
    }

    input, select, button {
      width: 100%;
      font-size: 0.95rem;
    }

    .subjectRow {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    h1, h2 {
      font-size: 1.3rem;
      text-align: center;
    }

    .add-semester-btn {
      width: 100%;
      font-size: 1rem;
      padding: 12px;
    }

    footer {
      text-align: center;
      font-size: 0.85rem;
    }
  }
footer {
  text-align: center;
  padding: 12px 0;
  font-size: 14px;
  opacity: 0.6;
  position: relative;
  bottom: 0;
  width: 100%;
  color: #ccc;
}
</style>
</head>
<body>
  <div class="sky" aria-hidden="true"></div>

  <div class="wrap">
    <div class="card" role="main" aria-labelledby="appTitle">
      <header class="top">
        <div class="brand">
          <div class="logo">NU</div>
          <div>
            <h1 id="appTitle">Narula University Grade Portal</h1>
            <div class="subtitle">Glassy SGPA & CGPA tool â€” local save & compare</div>
          </div>
        </div>

        <div class="controlsTop">
          <button id="themeToggle" class="themeToggle" title="Toggle theme" aria-pressed="false">
            <span id="themeIcon" class="icon">ðŸŒ™</span><span class="small">Dark</span>
          </button>

          <div class="profile" role="form" aria-label="Student profile">
            <div style="display:flex;flex-direction:column">
              <label class="small">Name</label>
              <input id="inpName" aria-label="Student name" placeholder="Your name">
            </div>
            <div style="display:flex;flex-direction:column">
              <label class="small">Roll</label>
              <input id="inpRoll" aria-label="Student roll" placeholder="Roll no">
            </div>
            <button class="outline" id="saveProfile">Save</button>
          </div>
        </div>
      </header>

      <div class="grid">
        <main class="panel" aria-labelledby="semTitle">
          <div class="sectionTitle">
            <h2 id="semTitle">Semesters & Subjects</h2>
            <div class="muted">Add semesters, fill marks, then calculate SGPA / CGPA</div>
          </div>

          <div class="tabs" role="tablist" aria-label="Calculator tabs">
            <div class="tab active" data-tab="sgpa">SGPA Calculator</div>
            <div class="tab" data-tab="cgpa">CGPA Calculator</div>
            <div style="flex:1"></div>
            <div class="muted">Dark / Light and local-saving supported</div>
          </div>

          <div style="display:flex;gap:10px;align-items:center;margin:10px 0 14px;">
            <button id="addSemesterBtn" class="actionBtn">+ Add Semester</button>
            <select id="presetSelect" class="select presetDropdown" aria-label="Choose preset">
              <option value="">Choose preset subjects (optional)</option>
            </select>
            <button id="applyPreset" class="outline">Apply preset</button>
            <div style="flex:1"></div>
            <button id="clearAllBtn" class="outline">Clear All Data</button>
          </div>

          <div id="sgpaPanel">
            <div id="semList" class="semList" aria-live="polite" aria-atomic="true"></div>
          </div>

          <div id="cgpaPanel" style="display:none">
            <div style="margin-bottom:10px" class="muted">Add semester SGPA entries (automatically computed from SGPA panel or manual input)</div>
            <div id="cgpaList" class="semList"></div>
            <div style="display:flex;gap:8px;margin-top:10px">
              <button id="addCgpaRow" class="outline">+ Add SGPA Entry</button>
              <button id="calcCgpaBtn" class="actionBtn">Calculate CGPA</button>
            </div>
          </div>
        </main>

        <aside class="rightPanel" aria-labelledby="summaryTitle">
          <div class="cardStat">
            <div class="small">Logged in as</div>
            <div id="profileDisplay" class="small">â€” Not set â€”</div>
          </div>

          <div style="margin-bottom:12px">
            <div class="small">Latest SGPA</div>
            <div id="latestSGPA" class="big">â€”</div>
          </div>

          <div style="margin-bottom:12px">
            <div class="small">CGPA (All Semesters)</div>
            <div id="cgpaAll" class="big">â€”</div>
          </div>

          <!-- persistent SGPA bar (updated after calculation) -->
          <div id="persistentBar" class="persistentBarWrap" aria-hidden="false" style="display:none">
            <div class="persistentBarLabel">SGPA Visual</div>
            <div class="sgpaBarWrap">
              <div class="sgpaBar sgpaMarker" id="persistentBarInner">
                <div class="sgpaSeg segRed"></div>
                <div class="sgpaSeg segYellow"></div>
                <div class="sgpaSeg segLightGreen"></div>
                <div class="sgpaSeg segDarkGreen"></div>
                <div class="markerDot" id="persistentMarker" style="left:0%"></div>
              </div>
            </div>
            <div id="persistentText" class="muted" style="margin-top:6px">Latest SGPA: â€”</div>
          </div>

          <button id="calcAll" class="actionBtn glow">Calculate SGPA & CGPA</button>
          <button id="saveAll" class="outline" style="margin-top:10px">Save Record</button>
          <button id="viewSaved" class="outline" style="margin-top:8px">View Saved Records</button>
          <button id="compareBtn" class="outline" style="margin-top:8px">Compare Students</button>

          <div style="margin-top:14px">
            <div class="small">Last calculation details</div>
            <table id="detailsTable" aria-live="polite">
              <thead><tr><th>Sem</th><th>Subject</th><th>Marks</th><th>Cred</th><th>GP</th><th>Weighted</th></tr></thead>
              <tbody id="detailsBody"></tbody>
            </table>
          </div>

          <footer class="note">Tip: Data stored locally on your browser only. Use "Save Record" to preserve names/rolls for comparison.</footer>
        </aside>
      </div>
    </div>
  </div>

  <!-- Translucent popup overlay for results -->
  <div id="resultPopupOverlay" class="resultPopupOverlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="resultPopup" role="document" aria-labelledby="resultTitle">
      <div class="resultHeader">
        <div>
          <h3 id="resultTitle" style="margin:0;color:var(--accent)">Calculation Results</h3>
          <div class="muted" id="resultSubtitle">SGPA & CGPA summary</div>
        </div>
        <div>
          <button id="closeResult" class="closePopup" aria-label="Close results">Close</button>
        </div>
      </div>

      <div class="resultMain">
        <div class="resultValues">
          <div style="display:flex;gap:12px;align-items:center">
            <div>
              <div class="muted">Latest SGPA</div>
              <div id="popupSGPA" class="big">â€”</div>
            </div>
            <div>
              <div class="muted">CGPA</div>
              <div id="popupCGPA" class="big">â€”</div>
            </div>
          </div>

          <div class="sgpaBarWrap">
            <div class="sgpaBar" id="popupBar">
              <div class="sgpaSeg segRed"></div>
              <div class="sgpaSeg segYellow"></div>
              <div class="sgpaSeg segLightGreen"></div>
              <div class="sgpaSeg segDarkGreen"></div>
              <div class="markerDot" id="popupMarker" style="left:0%"></div>
            </div>
          </div>

          <div id="popupAdvice" class="muted" style="margin-top:10px">â€”</div>
        </div>
      </div>
    </div>
  </div>

  <div id="loginOverlay" class="overlay" style="display:none" role="dialog" aria-modal="true">
    <div class="loginCard">
      <h2>Welcome to Narula University Portal</h2>
      <p>Enter your name and roll number to start. You can save records and compare later.</p>
      <input id="loginName" placeholder="Enter Name">
      <input id="loginRoll" placeholder="Enter Roll Number">
      <div style="display:flex;gap:8px;justify-content:center;margin-top:12px">
        <button id="loginStart" class="actionBtn">Start</button>
        <button id="loginSkip" class="outline">Skip</button>
      </div>
    </div>
  </div>

  <div id="modal" class="overlay" style="display:none">
    <div class="loginCard" style="max-width:900px;overflow:auto;padding:18px">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3 id="modalTitle">Saved Records</h3>
        <button id="closeModal" class="outline">Close</button>
      </div>
      <div id="modalBody" style="margin-top:12px"></div>
    </div>
  </div>

<script>
/* ============================
   Small upgrades to existing JS
   (keeps your base functions mostly intact)
   Added persistent bar + translucent popup logic + mobile scroll fixes
   ============================ */

/* Presets */
const PRESETS = {
  "CSE First Year (R23)": [
    {name:"Computer Science (Th)", credits:3, type:'theory'},
    {name:"Physics (Th)", credits:3, type:'theory'},
    {name:"Maths (Th)", credits:3, type:'theory'},
    {name:"EVS (Th)", credits:2, type:'theory'},
    {name:"IKS (Th)", credits:1, type:'theory'},
    {name:"CS Practical", credits:1.5, type:'practical'},
    {name:"Physics Practical", credits:1.5, type:'practical'},
    {name:"Graphics Practical", credits:1.5, type:'practical'},
    {name:"Communication Practical", credits:1.5, type:'practical'}
  ],
  "ECE First Year (Sample)": [
    {name:"Electronics (Th)", credits:3, type:'theory'},
    {name:"AI (Th)", credits:2, type:'theory'},
    {name:"Chemistry (Th)", credits:2, type:'theory'},
    {name:"Maths (Th)", credits:3, type:'theory'},
    {name:"Humanities (Th)", credits:1, type:'theory'},
    {name:"Design Thinking (Th)", credits:1, type:'theory'},
    {name:"Electronics Practical", credits:1.5, type:'practical'},
    {name:"AI Practical", credits:1.5, type:'practical'},
    {name:"Chemistry Practical", credits:1, type:'practical'},
    {name:"Mechanical Practical", credits:1.5, type:'practical'}
  ]
};

/* Utilities */
function getGradePoint(total) {
  if (total >= 90) return 10;
  if (total >= 80) return 9;
  if (total >= 70) return 8;
  if (total >= 60) return 7;
  if (total >= 50) return 6;
  if (total >= 40) return 5;
  return 0;
}
function clamp(n,min,max){ return Math.max(min, Math.min(max, Number(n) || 0)); }
function escapeHtml(s){ if (!s && s !== 0) return ''; return String(s).replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c])); }

/* DOM refs */
const semList = document.getElementById('semList');
const presetSelect = document.getElementById('presetSelect');
const addSemesterBtn = document.getElementById('addSemesterBtn');
const applyPresetBtn = document.getElementById('applyPreset');
const calcAllBtn = document.getElementById('calcAll');
const saveAllBtn = document.getElementById('saveAll');
const viewSavedBtn = document.getElementById('viewSaved');
const compareBtn = document.getElementById('compareBtn');
const latestSGPAEl = document.getElementById('latestSGPA');
const cgpaAllEl = document.getElementById('cgpaAll');
const detailsBody = document.getElementById('detailsBody');
const inpName = document.getElementById('inpName');
const inpRoll = document.getElementById('inpRoll');
const saveProfileBtn = document.getElementById('saveProfile');
const profileDisplay = document.getElementById('profileDisplay');
const themeToggle = document.getElementById('themeToggle');
const themeIcon = document.getElementById('themeIcon');
const loginOverlay = document.getElementById('loginOverlay');
const loginStart = document.getElementById('loginStart');
const loginSkip = document.getElementById('loginSkip');
const loginName = document.getElementById('loginName');
const loginRoll = document.getElementById('loginRoll');
const modal = document.getElementById('modal');
const modalBody = document.getElementById('modalBody');
const modalTitle = document.getElementById('modalTitle');
const closeModal = document.getElementById('closeModal');
const clearAllBtn = document.getElementById('clearAllBtn');

/* popup refs */
const resultPopupOverlay = document.getElementById('resultPopupOverlay');
const popupSGPA = document.getElementById('popupSGPA');
const popupCGPA = document.getElementById('popupCGPA');
const popupMarker = document.getElementById('popupMarker');
const popupBar = document.getElementById('popupBar');
const popupAdvice = document.getElementById('popupAdvice');
const closeResult = document.getElementById('closeResult');

const persistentBar = document.getElementById('persistentBar');
const persistentMarker = document.getElementById('persistentMarker');
const persistentText = document.getElementById('persistentText');
const persistentBarInner = document.getElementById('persistentBarInner');

let HIDE_POPUP_ON_CLOSE = false;

/* State */
let SEMS = [];
let LAST_CALC = { latestSGPA: null, cgpa: null, details: [] };
let COMPARE_BUFFER = [];

/* Initialize preset dropdown */
function initPresets(){
  Object.keys(PRESETS).forEach(k=>{
    const opt = document.createElement('option'); opt.value=k; opt.textContent=k;
    presetSelect.appendChild(opt);
  });
}

/* New semester */
function newSemester(label, defaultType){
  // defaultType: 'mixed' | 'theory' | 'practical'
  const sem = { id: 's'+Date.now().toString(36).slice(-6), label: label || ('Sem ' + (SEMS.length+1)), defaultType: defaultType || 'mixed', subjects: [] };
  return sem;
}

/* Render semesters (updated: subject type select + dynamic fields) */
function renderSemesters(){
  semList.innerHTML = '';
  SEMS.forEach((sem, idx)=>{
    const el = document.createElement('div'); el.className='semester'; el.dataset.sid = sem.id;
    el.innerHTML = `
      <div class="semHead">
        <div>
          <div class="semTitle">${escapeHtml(sem.label)}</div>
          <div class="small muted">Subjects: ${sem.subjects.length} â€¢ Credits: ${sem.subjects.reduce((s,x)=>s+(Number(x.credits)||0),0)}</div>
        </div>
        <div class="semControls">
          <button class="outline" data-action="add-sub">+ Subject</button>
          <button class="outline" data-action="rename">Rename</button>
          <button class="outline" data-action="remove-sem">Remove</button>
        </div>
      </div>
      <div class="subjects"></div>
    `;
    semList.appendChild(el);

    const subjectsContainer = el.querySelector('.subjects');

    sem.subjects.forEach((s, sIdx)=>{
      const row = document.createElement('div'); row.className='subjectRow';

      // Type select, name, credits, marks fields, remove
      // We use the type selector to show/hide theory/practical inputs
      row.innerHTML = `
        <select class="subType" aria-label="Type">
          <option value="theory">Theory (30+70)</option>
          <option value="practical">Practical (100)</option>
        </select>
        <input type="text" class="subName" placeholder="Subject name" value="${escapeHtml(s.name)}" aria-label="Subject name">
        <input type="number" class="subCredit" placeholder="Credits" step="0.5" min="0" value="${escapeHtml(s.credits)}" aria-label="Credits">
        <div class="theoryFields" style="display:none">
          <input type="number" class="mid" placeholder="Mid (0-30)" min="0" max="30" value="${s.mid||''}" aria-label="Mid">
          <input type="number" class="end" placeholder="End (0-70)" min="0" max="70" value="${s.end||''}" aria-label="End">
        </div>
        <input type="number" class="total" placeholder="Total (0-100)" min="0" max="100" value="${s.total||''}" style="display:none" aria-label="Total">
        <button class="removeRow" data-action="remove-${sIdx}" title="Remove subject">âœ•</button>
      `;

      // append and then configure which fields to show according to s.type
      subjectsContainer.appendChild(row);

      const typeSel = row.querySelector('.subType');
      const nameInp = row.querySelector('.subName');
      const creditInp = row.querySelector('.subCredit');
      const theoryFields = row.querySelector('.theoryFields');
      const totalInp = row.querySelector('.total');

      // set initial type
      if (!s.type) s.type = sem.defaultType === 'theory' ? 'theory' : (sem.defaultType === 'practical' ? 'practical' : (s.total ? 'practical' : 'theory'));
      typeSel.value = s.type;

      function showFieldsForType(t){
        if (t === 'theory'){
          theoryFields.style.display = 'grid';
          theoryFields.style.gridTemplateColumns = '1fr 1fr';
          totalInp.style.display = 'none';
        } else {
          theoryFields.style.display = 'none';
          totalInp.style.display = 'block';
        }
      }
      showFieldsForType(s.type);

      // handlers: when type changes
      typeSel.addEventListener('change', (e)=>{
        s.type = e.target.value;
        showFieldsForType(s.type);
      });

      // remove handler
      row.querySelector('.removeRow').addEventListener('click', ()=>{
        sem.subjects.splice(sIdx,1);
        renderSemesters();
      });

      // live save inputs -> update s
      nameInp.addEventListener('input', ()=>{ s.name = nameInp.value; });
      creditInp.addEventListener('input', ()=>{ s.credits = parseFloat(creditInp.value) || 0; });

      const midInp = row.querySelector('.mid');
      const endInp = row.querySelector('.end');
      if (midInp) midInp.addEventListener('input', ()=>{ s.mid = midInp.value; });
      if (endInp) endInp.addEventListener('input', ()=>{ s.end = endInp.value; });
      if (totalInp) totalInp.addEventListener('input', ()=>{ s.total = totalInp.value; });
    });

    // controls
    el.querySelector('[data-action="add-sub"]').addEventListener('click', ()=>{
      // add subject defaulting to semester.defaultType
      const dtype = sem.defaultType || 'mixed';
      const addType = (dtype === 'theory') ? 'theory' : (dtype === 'practical' ? 'practical' : 'theory');
      sem.subjects.push({name:'New Subject', credits:3, type:addType, mid:'', end:'', total:''});
      renderSemesters();
    });
    el.querySelector('[data-action="rename"]').addEventListener('click', ()=>{
      const newName = prompt('Rename semester', sem.label);
      if (newName) { sem.label = newName.trim(); renderSemesters(); }
    });
    el.querySelector('[data-action="remove-sem"]').addEventListener('click', ()=>{
      if (!confirm('Remove entire semester?')) return;
      SEMS = SEMS.filter(s=>s.id !== sem.id);
      renderSemesters();
    });
  });
}

/* Add semester - prompt for name and default type */
addSemesterBtn.addEventListener('click', ()=>{
  let label = prompt('Enter semester name (leave blank for default):','Semester '+(SEMS.length+1));
  if (label === null) return; // cancelled
  label = label.trim() || ('Semester '+(SEMS.length+1));
  // ask for default type
  let dtype = prompt('Default subject type for this semester? (enter "theory", "practical", or "mixed")','mixed');
  if (dtype === null) dtype = 'mixed';
  dtype = dtype.toLowerCase();
  if (!['theory','practical','mixed'].includes(dtype)) dtype = 'mixed';
  const sem = newSemester(label, dtype);
  // if user chose theory or practical, add a sample subject to show UI
  if (dtype === 'theory') sem.subjects.push({name:'New Theory Subject', credits:3, type:'theory', mid:'', end:'', total:''});
  else if (dtype === 'practical') sem.subjects.push({name:'New Practical', credits:1.5, type:'practical', mid:'', end:'', total:''});
  SEMS.push(sem);
  renderSemesters();
});

/* Apply preset to chosen semester (prompt for target) */
applyPresetBtn.addEventListener('click', ()=>{
  if (!presetSelect.value) return alert('Choose a preset');
  if (SEMS.length === 0) { alert('Add a semester first'); return; }
  const names = SEMS.map((s,i)=>`${i+1}: ${s.label}`).join('\n');
  let choice = prompt(`Apply preset to which semester?\n${names}\nEnter number (1-${SEMS.length}) or leave blank for last:`);
  if (!choice) choice = SEMS.length.toString();
  const id = parseInt(choice) - 1;
  if (isNaN(id) || id < 0 || id >= SEMS.length) return alert('Invalid choice');
  applyPresetToSemester(SEMS[id].id, presetSelect.value);
});
function applyPresetToSemester(semId, presetName){
  if (!PRESETS[presetName]) { alert('Invalid preset'); return; }
  const preset = PRESETS[presetName];
  const sem = SEMS.find(s=>s.id === semId);
  if (!sem) { alert('Add a semester first'); return; }
  preset.forEach(p=> sem.subjects.push({name:p.name, credits:p.credits, type:p.type, mid:'', end:'', total:''}));
  renderSemesters();
}

/* helper to compute marker left% based on SGPA (0-10) */
function sgpaToPercent(sgpa){
  // map 0..10 => 0%..100%
  if (sgpa === null || sgpa === undefined) return 0;
  const v = Math.max(0, Math.min(10, Number(sgpa)||0));
  return (v/10)*100;
}
function getAdviceForSGPA(sgpa){
  if (sgpa === null) return 'â€”';
  const v = Number(sgpa);
  if (v <= 4) return 'Poor â€” needs improvement';
  if (v <= 6) return 'Average â€” keep working';
  if (v <= 8) return 'Good â€” nice!';
  return 'Excellent â€” great job!';
}

/* Calculate SGPA and CGPA (unchanged logic, but handles dynamic types) */
function calculateAll(){
  const details = [];
  let cgpaPoints = 0;
  let cgpaCredits = 0;
  let latestSGPA = null;

  SEMS.forEach((sem) => {
    let semPoints = 0, semCredits = 0;
    sem.subjects.forEach(s=>{
      const credit = Number(s.credits) || 0;
      if (!(credit > 0)) return;
      let totalMarks = 0;
      if (s.type === 'theory') {
        const mid = clamp(s.mid, 0, 30);
        const end = clamp(s.end, 0, 70);
        totalMarks = mid + end;
      } else {
        totalMarks = clamp(s.total, 0, 100);
      }
      const gp = getGradePoint(totalMarks);
      semPoints += gp * credit;
      semCredits += credit;
      details.push({semester: sem.label, subject: s.name, marks: totalMarks, credits: credit, gp, weighted: gp*credit});
    });

    const semSGPA = semCredits > 0 ? (semPoints / semCredits) : null;
    if (semSGPA !== null) {
      cgpaPoints += semPoints;
      cgpaCredits += semCredits;
      latestSGPA = semSGPA;
    }
  });

  const cgpa = cgpaCredits > 0 ? (cgpaPoints / cgpaCredits) : null;

  latestSGPAEl.textContent = latestSGPA === null ? 'â€”' : latestSGPA.toFixed(2);
  cgpaAllEl.textContent = cgpa === null ? 'â€”' : cgpa.toFixed(2);

  detailsBody.innerHTML = '';
  details.forEach(d=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${escapeHtml(d.semester)}</td>
                    <td>${escapeHtml(d.subject)}</td>
                    <td>${d.marks}</td>
                    <td>${d.credits}</td>
                    <td>${d.gp}</td>
                    <td>${d.weighted.toFixed(2)}</td>`;
    detailsBody.appendChild(tr);
  });

  LAST_CALC = { latestSGPA: latestSGPA, cgpa: cgpa, details: details };
  return LAST_CALC;
}

/* Show popup + persistent bar */
function showResultPopup(calc){
  if (!calc) return;
  const latest = calc.latestSGPA;
  const cgpa = calc.cgpa;

  // populate popup
  popupSGPA.textContent = latest === null ? 'â€”' : (Number(latest).toFixed(2));
  popupCGPA.textContent = cgpa === null ? 'â€”' : (Number(cgpa).toFixed(2));
  popupAdvice.textContent = getAdviceForSGPA(latest);

  // marker position
  const pct = sgpaToPercent(latest);
  popupMarker.style.left = pct + '%';

  // show overlay
  resultPopupOverlay.style.display = 'flex';
  resultPopupOverlay.setAttribute('aria-hidden','false');
  // also update persistent bar (so it stays after closing)
  updatePersistentBar(latest);
}

/* Update persistent bar area (right panel) */
function updatePersistentBar(latest){
  if (latest === null || latest === undefined) {
    persistentBar.style.display = 'none';
    return;
  }
  persistentBar.style.display = 'block';
  const pct = sgpaToPercent(latest);
  persistentMarker.style.left = pct + '%';
  persistentText.textContent = 'Latest SGPA: ' + (Number(latest).toFixed(2));
}

/* Popup close */
closeResult.addEventListener('click', ()=>{
  resultPopupOverlay.style.display = 'none';
  resultPopupOverlay.setAttribute('aria-hidden','true');
  // persistent bar remains (already updated)
});

/* Close popup on overlay click */
resultPopupOverlay.addEventListener('click', (e)=>{
  if (e.target === resultPopupOverlay){
    resultPopupOverlay.style.display = 'none';
    resultPopupOverlay.setAttribute('aria-hidden','true');
  }
});

/* CGPA manual entries (unchanged) */
const cgpaList = document.getElementById('cgpaList');
const addCgpaRowBtn = document.getElementById('addCgpaRow');
const calcCgpaBtn = document.getElementById('calcCgpaBtn');
function addCgpaRow(sgpa='', credits=''){
  const div = document.createElement('div'); div.className='semester';
  div.innerHTML = `
    <div style="display:flex;gap:8px;align-items:center">
      <input placeholder="SGPA" type="number" step="0.01" min="0" max="10" value="${escapeHtml(sgpa)}" style="padding:8px;border-radius:8px;border:none;background:rgba(0,0,0,0.06);flex:1">
      <input placeholder="Credits" type="number" step="0.5" min="0" value="${escapeHtml(credits)}" style="padding:8px;border-radius:8px;border:none;background:rgba(0,0,0,0.06);width:120px">
      <button class="outline" style="margin-left:8px">Remove</button>
    </div>
  `;
  cgpaList.appendChild(div);
  div.querySelector('button').addEventListener('click', ()=>div.remove());
}
addCgpaRowBtn?.addEventListener('click', ()=>addCgpaRow());
calcCgpaBtn?.addEventListener('click', ()=>{
  const rows = Array.from(cgpaList.querySelectorAll('.semester'));
  let totalCredits = 0, totalWeighted=0;
  rows.forEach(r=>{
    const sgpa = parseFloat(r.querySelectorAll('input')[0].value) || 0;
    const creds = parseFloat(r.querySelectorAll('input')[1].value) || 0;
    if (creds>0){ totalCredits += creds; totalWeighted += sgpa*creds; }
  });
  if (totalCredits === 0){ alert('Enter SGPA entries with credits'); return; }
  const cgpa = (totalWeighted/totalCredits).toFixed(2);
  cgpaAllEl.textContent = cgpa;
});

/* Save & load records */
function saveAllLocal(){
  const profile = {name: inpName.value.trim(), roll: inpRoll.value.trim()};
  if (!profile.name || !profile.roll) return alert('Please enter name and roll to save record.');
  const state = { profile, semesters: SEMS, lastCalc: LAST_CALC, timestamp: Date.now() };
  const recordsRaw = localStorage.getItem('nu_records');
  let records = recordsRaw ? JSON.parse(recordsRaw) : [];
  records = records.filter(r=>r.roll !== profile.roll);
  records.push(Object.assign({id:profile.roll}, {name:profile.name, roll:profile.roll, data:state}));
  localStorage.setItem('nu_records', JSON.stringify(records));
  alert('Record saved locally.');
}
function loadAllLocal(){
  const raw = localStorage.getItem('nu_records');
  if (!raw) return [];
  try { return JSON.parse(raw); } catch(e){ console.warn(e); return []; }
}

/* View saved records modal */
viewSavedBtn.addEventListener('click', ()=>{
  const recs = loadAllLocal();
  showModalSaved(recs);
});
function showModalSaved(recs){
  modalTitle.textContent = 'Saved Records';
  if (!Array.isArray(recs) || recs.length===0){
    modalBody.innerHTML = '<p class="muted">No saved records found.</p>';
    modal.style.display='flex'; return;
  }
  let html = `<div style="overflow:auto"><table style="width:100%;border-collapse:collapse"><thead><tr><th>Name</th><th>Roll</th><th>SGPA</th><th>CGPA</th><th>Saved</th><th>Actions</th></tr></thead><tbody>`;
  recs.forEach(r=>{
    const sgpa = r.data.lastCalc && r.data.lastCalc.latestSGPA ? (r.data.lastCalc.latestSGPA.toFixed? r.data.lastCalc.latestSGPA.toFixed(2): r.data.lastCalc.latestSGPA) : 'â€”';
    const cgpa = r.data.lastCalc && r.data.lastCalc.cgpa ? (r.data.lastCalc.cgpa.toFixed? r.data.lastCalc.cgpa.toFixed(2): r.data.lastCalc.cgpa) : 'â€”';
    html += `<tr data-roll="${escapeHtml(r.roll)}"><td>${escapeHtml(r.name)}</td><td>${escapeHtml(r.roll)}</td><td>${sgpa}</td><td>${cgpa}</td><td>${new Date(r.data.timestamp||Date.now()).toLocaleString()}</td>
             <td>
               <button class="outline loadRec">Load</button>
               <button class="outline compareRec">Compare</button>
               <button class="outline delRec" style="background:${'transparent'};border:1px solid rgba(255,0,0,0.12);color:var(--danger)">Delete</button>
             </td></tr>`;
  });
  html += `</tbody></table></div>`;
  modalBody.innerHTML = html;
  Array.from(modalBody.querySelectorAll('.loadRec')).forEach(btn=>{
    btn.addEventListener('click', (e)=>{ const roll = e.target.closest('tr').dataset.roll; loadRecordToUI(roll); modal.style.display='none'; });
  });
  Array.from(modalBody.querySelectorAll('.compareRec')).forEach(btn=>{
    btn.addEventListener('click', (e)=>{ const roll = e.target.closest('tr').dataset.roll; addRecordToCompare(roll); });
  });
  Array.from(modalBody.querySelectorAll('.delRec')).forEach(btn=>{
    btn.addEventListener('click', (e)=>{ const roll = e.target.closest('tr').dataset.roll; if (!confirm('Delete this record?')) return; deleteRecord(roll); showModalSaved(loadAllLocal()); });
  });
  modal.style.display='flex';
}

/* Load record into UI */
function loadRecordToUI(roll){
  const recs = loadAllLocal();
  const r = recs.find(x=>x.roll === roll);
  if (!r) return alert('Record not found');
  inpName.value = r.name || ''; inpRoll.value = r.roll || '';
  updateProfileDisplay();
  SEMS = r.data.semesters || [];
  renderSemesters();
  LAST_CALC = r.data.lastCalc || {latestSGPA:null,cgpa:null,details:[]};
  latestSGPAEl.textContent = LAST_CALC.latestSGPA === null ? 'â€”' : (LAST_CALC.latestSGPA.toFixed?LAST_CALC.latestSGPA.toFixed(2):LAST_CALC.latestSGPA);
  cgpaAllEl.textContent = LAST_CALC.cgpa === null ? 'â€”' : (LAST_CALC.cgpa.toFixed?LAST_CALC.cgpa.toFixed(2):LAST_CALC.cgpa);
  detailsBody.innerHTML = '';
  (LAST_CALC.details||[]).forEach(d=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${escapeHtml(d.semester)}</td><td>${escapeHtml(d.subject)}</td><td>${d.marks}</td><td>${d.credits}</td><td>${d.gp}</td><td>${d.weighted.toFixed(2)}</td>`;
    detailsBody.appendChild(tr);
  });

  // update persistent bar if record had lastCalc
  if (LAST_CALC && LAST_CALC.latestSGPA !== null) updatePersistentBar(LAST_CALC.latestSGPA);

  alert('Record loaded into UI');
}
function deleteRecord(roll){
  let recs = loadAllLocal();
  recs = recs.filter(r=>r.roll !== roll);
  localStorage.setItem('nu_records', JSON.stringify(recs));
}

/* Compare buffer & show compare */
function addRecordToCompare(roll){
  const recs = loadAllLocal();
  const r = recs.find(x=>x.roll === roll);
  if (!r) return alert('Record not found');
  if (COMPARE_BUFFER.find(c=>c.roll===roll)) return alert('Already in compare buffer');
  COMPARE_BUFFER.push(r);
  if (COMPARE_BUFFER.length === 2) {
    showCompare(COMPARE_BUFFER[0], COMPARE_BUFFER[1]);
    COMPARE_BUFFER = [];
  } else {
    alert('Record added to compare buffer. Add one more record to compare.');
  }
}
compareBtn.addEventListener('click', ()=>{
  const recs = loadAllLocal();
  if (recs.length < 2) return alert('Need at least 2 saved records to compare. Save more records first.');
  showModalSaved(recs);
});

function showCompare(a,b){
  modalTitle.textContent = `Compare â€” ${escapeHtml(a.name)} vs ${escapeHtml(b.name)}`;
  const aSGPA = a.data.lastCalc && a.data.lastCalc.latestSGPA ? (a.data.lastCalc.latestSGPA.toFixed? a.data.lastCalc.latestSGPA.toFixed(2): a.data.lastCalc.latestSGPA): 'â€”';
  const bSGPA = b.data.lastCalc && b.data.lastCalc.latestSGPA ? (b.data.lastCalc.latestSGPA.toFixed? b.data.lastCalc.latestSGPA.toFixed(2): b.data.lastCalc.latestSGPA): 'â€”';
  const aCGPA = a.data.lastCalc && a.data.lastCalc.cgpa ? (a.data.lastCalc.cgpa.toFixed? a.data.lastCalc.cgpa.toFixed(2): a.data.lastCalc.cgpa): 'â€”';
  const bCGPA = b.data.lastCalc && b.data.lastCalc.cgpa ? (b.data.lastCalc.cgpa.toFixed? b.data.lastCalc.cgpa.toFixed(2): b.data.lastCalc.cgpa): 'â€”';
  const html = `
    <div style="display:flex;gap:12px;align-items:flex-start">
      <div style="flex:1">
        <h4>${escapeHtml(a.name)} (${escapeHtml(a.roll)})</h4>
        <p>Latest SGPA: <b>${aSGPA}</b></p>
        <p>CGPA: <b>${aCGPA}</b></p>
      </div>
      <div style="flex:1">
        <h4>${escapeHtml(b.name)} (${escapeHtml(b.roll)})</h4>
        <p>Latest SGPA: <b>${bSGPA}</b></p>
        <p>CGPA: <b>${bCGPA}</b></p>
      </div>
    </div>
  `;
  modalBody.innerHTML = html;
  modal.style.display='flex';
}

/* Export report (if export button exists) */
document.getElementById('exportReport')?.addEventListener?.('click', ()=>{
  let text = `Narula University SGPA Report\nName: ${inpName.value||'â€”'}\nRoll: ${inpRoll.value||'â€”'}\nCGPA: ${cgpaAllEl.textContent}\nLatest SGPA: ${latestSGPAEl.textContent}\n\nDetails:\n`;
  const rows = Array.from(detailsBody.querySelectorAll('tr'));
  rows.forEach(r=>{
    const cols = Array.from(r.children).map(c=>c.textContent);
    text += cols.join(' | ') + '\n';
  });
  navigator.clipboard.writeText(text).then(()=>alert('Report copied to clipboard'), ()=>alert('Copy failed'));
});

/* Save profile button */
saveProfileBtn.addEventListener('click', ()=>{
  updateProfileDisplay();
  localStorage.setItem('nu_profile', JSON.stringify({name: inpName.value.trim(), roll: inpRoll.value.trim()}));
  alert('Profile saved locally.');
});
function updateProfileDisplay(){
  const n = inpName.value.trim(); const r = inpRoll.value.trim();
  profileDisplay.textContent = n ? `${n} â€¢ ${r||'â€”'}` : 'â€” Not set â€”';
}

/* Theme toggle with storage */
function setTheme(isLight){
  if (isLight) {
    document.body.classList.add('light'); themeIcon.textContent = 'â˜€ï¸'; themeToggle.setAttribute('aria-pressed','true');
  } else {
    document.body.classList.remove('light'); themeIcon.textContent = 'ðŸŒ™'; themeToggle.setAttribute('aria-pressed','false');
  }
  localStorage.setItem('nu_theme_light',''+Boolean(isLight));
}
themeToggle.addEventListener('click', ()=>{
  const isLight = document.body.classList.contains('light');
  setTheme(!isLight);
});

/* Modal controls */
closeModal.addEventListener('click', ()=>{ modal.style.display='none'; });
modal.addEventListener('click', (e)=>{ if (e.target === modal) modal.style.display='none'; });

/* Login overlay */
function showLoginIfNeeded(){
  const saved = localStorage.getItem('nu_profile');
  if (saved) {
    const p = JSON.parse(saved);
    inpName.value = p.name || ''; inpRoll.value = p.roll || '';
    updateProfileDisplay();
    loginOverlay.style.display='none';
    return;
  }
  loginOverlay.style.display='flex';
}
loginStart.addEventListener('click', ()=>{
  const n = loginName.value.trim(); const r = loginRoll.value.trim();
  if (!n || !r) return alert('Please enter both name and roll');
  inpName.value = n; inpRoll.value = r;
  localStorage.setItem('nu_profile', JSON.stringify({name:n, roll:r}));
  updateProfileDisplay();
  loginOverlay.style.display='none';
});
loginSkip.addEventListener('click', ()=>{ loginOverlay.style.display='none'; });

/* Clear all local data */
clearAllBtn.addEventListener('click', ()=>{
  if (!confirm('This will remove all saved records and reset UI. Continue?')) return;
  localStorage.removeItem('nu_records');
  localStorage.removeItem('nu_profile');
  localStorage.removeItem('nu_theme_light');
  SEMS = [];
  renderSemesters();
  inpName.value=''; inpRoll.value=''; updateProfileDisplay();
  latestSGPAEl.textContent = 'â€”'; cgpaAllEl.textContent = 'â€”'; detailsBody.innerHTML='';
  persistentBar.style.display = 'none';
  alert('Cleared local saved data.');
});

/* Calculate and save handlers */
calcAllBtn.addEventListener('click', ()=>{
  const res = calculateAll();
  if (!res || res.latestSGPA === null) {
    alert('No credits entered. Please add subjects and credits and fill marks.');
    return;
  }
  // show the translucent popup with results and update persistent visual
  showResultPopup(res);
});
saveAllBtn.addEventListener('click', ()=>{ saveAllLocal(); });

/* Init */
function init(){
  initPresets();
  setTheme(localStorage.getItem('nu_theme_light') === 'true');
  const prof = localStorage.getItem('nu_profile');
  if (prof) { const p = JSON.parse(prof); inpName.value = p.name||''; inpRoll.value = p.roll||''; updateProfileDisplay(); }
  else { setTimeout(()=>showLoginIfNeeded(), 250); }

  if (SEMS.length === 0) {
    const s = newSemester('Semester 1 (sample)', 'mixed');
    PRESETS['CSE First Year (R23)']?.forEach(p=> s.subjects.push(Object.assign({}, {name:p.name, credits:p.credits, type:p.type, mid:'', end:'', total:''})));
    SEMS.push(s);
  }
  renderSemesters();

  // if a saved profile exists that contains a lastCalc, show persistent bar
  const recs = loadAllLocal();
  if (recs && recs.length) {
    // check latest profile (not strictly necessary) â€” leave persistent hidden until calculation or load
  }
}
init();
</script>
<footer>
  Created by Himadri
</footer>
</body>
</html>
